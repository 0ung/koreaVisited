"use client";

import { useTranslations } from "next-intl";
import { useSearchParams, useRouter, useParams } from "next/navigation";
import { useState, useEffect, useMemo, useCallback } from "react";
import { Button } from "@/components/ui/Button";
import { Input } from "@/components/ui/Input";
import { Card, CardContent } from "@/components/ui/Card";
import { Skeleton } from "@/components/ui/Skeleton";
import { Modal } from "@/components/ui/Modal";
import { cn } from "@/utils/cn";
import { debounce } from "@/utils/debounce";
import SearchResultItem from "@/components/SearchResultItem";
import SearchEmptyState from "@/components/SearchEmptyState";
import {
  searchHistory,
  searchSuggestions,
  searchUrl,
  searchResults,
  searchAnalytics,
  geoUtils,
} from "@/utils/search";

// ÌÉÄÏûÖ Ï†ïÏùò
interface Place {
  id: string;
  name: {
    ko: string;
    en: string;
    ja: string;
  };
  address: {
    ko: string;
    en: string;
    ja: string;
  };
  lat: number;
  lon: number;
  category_std: string;
  rating_avg: number;
  review_count: number;
  main_image_urls: string[];
  recommendation_score: number;
  distance?: number;
  isOpen?: boolean;
  priceLevel?: number;
  tags: string[];
  crowd_index?: number;
}

interface SearchFilters {
  category: string;
  location: string;
  rating: number;
  priceLevel: string;
  distance: string;
  openNow: boolean;
  freeWifi: boolean;
  parking: boolean;
  accessibility: boolean;
}

interface SearchState {
  query: string;
  filters: SearchFilters;
  sortBy: string;
  viewMode: "list" | "map";
  page: number;
  hasMore: boolean;
}

export default function SearchPage() {
  const t = useTranslations("Search");
  const router = useRouter();
  const searchParams = useSearchParams();
  const locale = useParams().locale as string; // ÌòÑÏû¨ Ïñ∏Ïñ¥ Í∞ÄÏ†∏Ïò§Í∏∞

  // ÏÉÅÌÉú Í¥ÄÎ¶¨
  const [searchState, setSearchState] = useState<SearchState>({
    query: searchParams.get("q") || "",
    filters: {
      category: searchParams.get("category") || "all",
      location: "",
      rating: 0,
      priceLevel: "all",
      distance: "all",
      openNow: false,
      freeWifi: false,
      parking: false,
      accessibility: false,
    },
    sortBy: "relevance",
    viewMode: "list",
    page: 1,
    hasMore: true,
  });

  const [places, setPlaces] = useState<Place[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [totalResults, setTotalResults] = useState(0);
  const [isFilterModalOpen, setIsFilterModalOpen] = useState(false);
  const [savedPlaces, setSavedPlaces] = useState<Set<string>>(new Set());

  // Ïπ¥ÌÖåÍ≥†Î¶¨ Ï†ïÏùò
  const categories = [
    { id: "all", name: t("categories.all"), icon: "üîç" },
    { id: "restaurants", name: t("categories.restaurants"), icon: "üçú" },
    { id: "cafes", name: t("categories.cafes"), icon: "‚òï" },
    { id: "attractions", name: t("categories.attractions"), icon: "üèûÔ∏è" },
    { id: "hotels", name: t("categories.hotels"), icon: "üè®" },
    { id: "shopping", name: t("categories.shopping"), icon: "üõçÔ∏è" },
    { id: "nightlife", name: t("categories.nightlife"), icon: "üåô" },
    { id: "culture", name: t("categories.culture"), icon: "üéé" },
    { id: "nature", name: t("categories.nature"), icon: "üåø" },
    { id: "sports", name: t("categories.sports"), icon: "‚öΩ" },
  ];

  // Ï†ïÎ†¨ ÏòµÏÖò
  const sortOptions = [
    { value: "relevance", label: t("sorting.relevance") },
    { value: "rating", label: t("sorting.rating") },
    { value: "distance", label: t("sorting.distance") },
    { value: "price_low", label: t("sorting.price_low") },
    { value: "price_high", label: t("sorting.price_high") },
    { value: "newest", label: t("sorting.newest") },
    { value: "popular", label: t("sorting.popular") },
  ];

  // Îπ†Î•∏ ÌïÑÌÑ∞
  const quickFilters = [
    { id: "nearMe", label: t("quickFilters.nearMe"), icon: "üìç" },
    { id: "openNow", label: t("quickFilters.openNow"), icon: "üïê" },
    { id: "topRated", label: t("quickFilters.topRated"), icon: "‚≠ê" },
    { id: "budget", label: t("quickFilters.budget"), icon: "üí∞" },
    { id: "luxury", label: t("quickFilters.luxury"), icon: "üëë" },
    { id: "trending", label: t("quickFilters.trending"), icon: "üî•" },
  ];

  // ÎîîÎ∞îÏö¥Ïä§Îêú Í≤ÄÏÉâ Ìï®Ïàò
  const debouncedSearch = useCallback(
    debounce((query: string, filters: SearchFilters, sortBy: string) => {
      performSearch(query, filters, sortBy, 1);
    }, 300),
    []
  );

  // Í≤ÄÏÉâ Ïã§Ìñâ
  const performSearch = async (
    query: string,
    filters: SearchFilters,
    sortBy: string,
    page: number = 1
  ) => {
    setIsLoading(true);

    try {
      // Ïã§Ï†ú API Ìò∏Ï∂ú (locale Ìè¨Ìï®)
      // const response = await fetch('/api/search', {
      //   method: 'POST',
      //   headers: { 'Content-Type': 'application/json' },
      //   body: JSON.stringify({
      //     query,
      //     filters,
      //     sortBy,
      //     page,
      //     locale // Ïñ∏Ïñ¥ Ï†ïÎ≥¥ Ï†ÑÎã¨
      //   })
      // });
      // const data = await response.json();

      // ÌòÑÏû¨Îäî Î™©ÏóÖ Îç∞Ïù¥ÌÑ∞Î°ú ÏãúÎÆ¨Î†àÏù¥ÏÖò
      await new Promise((resolve) => setTimeout(resolve, 800));

      // Î™©ÏóÖ Îç∞Ïù¥ÌÑ∞
      const mockPlaces: Place[] = [
        {
          id: "1",
          name: {
            ko: "Î∂ÄÏÇ∞ Í∞êÏ≤úÎ¨∏ÌôîÎßàÏùÑ",
            en: "Gamcheon Culture Village",
            ja: "ÈáúÂ±±ÁîòÂ∑ùÊñáÂåñÊùë",
          },
          address: {
            ko: "Î∂ÄÏÇ∞ ÏÇ¨ÌïòÍµ¨ Í∞êÎÇ¥2Î°ú 203",
            en: "203 Gamnae 2-ro, Saha-gu, Busan",
            ja: "ÈáúÂ±±Ê≤ô‰∏ãÂå∫ÁîòÂÜÖ2Ë∑Ø203",
          },
          lat: 35.0976,
          lon: 129.0092,
          category_std: "attractions",
          rating_avg: 4.5,
          review_count: 1250,
          main_image_urls: ["/images/gamcheon.jpg"],
          recommendation_score: 9.2,
          distance: 1200,
          isOpen: true,
          priceLevel: 1,
          tags: ["Ìè¨ÌÜ†Ï°¥", "ÏòàÏà†", "Ïñ∏ÎçïÎßàÏùÑ"],
          crowd_index: 65,
        },
        {
          id: "2",
          name: {
            ko: "ÌôçÎåÄ Ìï©Ï†ïÏó≠ Ïπ¥ÌéòÍ±∞Î¶¨",
            en: "Hongdae Hapjeong Cafe Street",
            ja: "ÂºòÂ§ßÂêà‰∫ïÈßÖ„Ç´„Éï„ÇßË°ó",
          },
          address: {
            ko: "ÏÑúÏö∏ ÎßàÌè¨Íµ¨ ÏôÄÏö∞ÏÇ∞Î°ú",
            en: "Wausan-ro, Mapo-gu, Seoul",
            ja: "„ÇΩ„Ç¶„É´È∫ªÊµ¶Âå∫„ÉØ„Ç¶Â±±Ë∑Ø",
          },
          lat: 37.5547,
          lon: 126.9236,
          category_std: "cafes",
          rating_avg: 4.3,
          review_count: 890,
          main_image_urls: ["/images/hongdae-cafe.jpg"],
          recommendation_score: 8.7,
          distance: 800,
          isOpen: true,
          priceLevel: 2,
          tags: ["Ìä∏Î†åÎîî", "Ïù∏Ïä§ÌÉÄ", "Îç∞Ïù¥Ìä∏"],
          crowd_index: 78,
        },
        {
          id: "3",
          name: {
            ko: "Î™ÖÎèô ÏπºÍµ≠Ïàò Í≥®Î™©",
            en: "Myeongdong Kalguksu Alley",
            ja: "ÊòéÊ¥û„Ç´„É´„Ç∞„ÇØ„ÇπÊ®™‰∏Å",
          },
          address: {
            ko: "ÏÑúÏö∏ Ï§ëÍµ¨ Î™ÖÎèô2Í∞Ä",
            en: "Myeongdong 2-ga, Jung-gu, Seoul",
            ja: "„ÇΩ„Ç¶„É´‰∏≠Âå∫ÊòéÊ¥û2Ë°ó",
          },
          lat: 37.5636,
          lon: 126.9834,
          category_std: "restaurants",
          rating_avg: 4.7,
          review_count: 2100,
          main_image_urls: ["/images/myeongdong-food.jpg"],
          recommendation_score: 9.1,
          distance: 1500,
          isOpen: true,
          priceLevel: 1,
          tags: ["ÌòÑÏßÄÎßõÏßë", "Ï†ÄÎ†¥", "Ï†ÑÌÜµ"],
          crowd_index: 45,
        },
      ];

      // ÌïÑÌÑ∞ÎßÅ Î°úÏßÅ
      let filteredPlaces = mockPlaces;

      if (filters.category !== "all") {
        filteredPlaces = filteredPlaces.filter(
          (place) => place.category_std === filters.category
        );
      }

      if (filters.rating > 0) {
        filteredPlaces = filteredPlaces.filter(
          (place) => place.rating_avg >= filters.rating
        );
      }

      if (filters.openNow) {
        filteredPlaces = filteredPlaces.filter((place) => place.isOpen);
      }

      // Ï†ïÎ†¨ Î°úÏßÅ
      switch (sortBy) {
        case "rating":
          filteredPlaces.sort((a, b) => b.rating_avg - a.rating_avg);
          break;
        case "distance":
          filteredPlaces.sort((a, b) => (a.distance || 0) - (b.distance || 0));
          break;
        case "popular":
          filteredPlaces.sort((a, b) => b.review_count - a.review_count);
          break;
        default:
          filteredPlaces.sort(
            (a, b) => b.recommendation_score - a.recommendation_score
          );
      }

      if (page === 1) {
        setPlaces(filteredPlaces);
      } else {
        setPlaces((prev) => [...prev, ...filteredPlaces]);
      }

      setTotalResults(filteredPlaces.length);
      setSearchState((prev) => ({
        ...prev,
        page,
        hasMore: filteredPlaces.length >= 20,
      }));
    } catch (error) {
      console.error("Í≤ÄÏÉâ Ïã§Ìå®:", error);
    } finally {
      setIsLoading(false);
    }
  };

  // Í≤ÄÏÉâÏñ¥ Î≥ÄÍ≤Ω Ï≤òÎ¶¨
  const handleSearchChange = (newQuery: string) => {
    setSearchState((prev) => ({ ...prev, query: newQuery }));
    debouncedSearch(newQuery, searchState.filters, searchState.sortBy);
  };

  // ÌïÑÌÑ∞ Î≥ÄÍ≤Ω Ï≤òÎ¶¨
  const handleFilterChange = (newFilters: Partial<SearchFilters>) => {
    const updatedFilters = { ...searchState.filters, ...newFilters };
    setSearchState((prev) => ({ ...prev, filters: updatedFilters }));
    performSearch(searchState.query, updatedFilters, searchState.sortBy);
  };

  // Ï†ïÎ†¨ Î≥ÄÍ≤Ω Ï≤òÎ¶¨
  const handleSortChange = (newSort: string) => {
    setSearchState((prev) => ({ ...prev, sortBy: newSort }));
    performSearch(searchState.query, searchState.filters, newSort);
  };

  // Ïû•ÏÜå Ï†ÄÏû• ÌÜ†Í∏Ä
  const toggleSavePlace = (placeId: string) => {
    setSavedPlaces((prev) => {
      const newSet = new Set(prev);
      if (newSet.has(placeId)) {
        newSet.delete(placeId);
      } else {
        newSet.add(placeId);
      }
      return newSet;
    });
  };

  // Îπ†Î•∏ ÌïÑÌÑ∞ Ï†ÅÏö©
  const applyQuickFilter = (filterId: string) => {
    switch (filterId) {
      case "openNow":
        handleFilterChange({ openNow: !searchState.filters.openNow });
        break;
      case "topRated":
        handleFilterChange({
          rating: searchState.filters.rating === 4 ? 0 : 4,
        });
        break;
      // Îã§Î•∏ Îπ†Î•∏ ÌïÑÌÑ∞Îì§ÎèÑ Íµ¨ÌòÑ Í∞ÄÎä•
    }
  };

  // Ï¥àÍ∏∞ Í≤ÄÏÉâ Ïã§Ìñâ
  useEffect(() => {
    const urlData = searchUrl.parseSearchUrl(searchParams);
    setSearchState((prev) => ({
      ...prev,
      query: urlData.query,
      filters: urlData.filters,
      sortBy: urlData.sortBy,
    }));

    if (urlData.query) {
      performSearch(urlData.query, urlData.filters, urlData.sortBy);
    }
  }, []);

  // Í≤ÄÏÉâÏñ¥Î•º ÌûàÏä§ÌÜ†Î¶¨Ïóê Ï∂îÍ∞Ä
  const addToSearchHistory = (query: string) => {
    if (query.trim()) {
      searchHistory.addToHistory(query.trim());
    }
  };

  // ÌòºÏû°ÎèÑ ÏÉâÏÉÅ
  const getCrowdColor = (crowdIndex: number) => {
    if (crowdIndex <= 30) return "text-green-600 bg-green-100";
    if (crowdIndex <= 70) return "text-yellow-600 bg-yellow-100";
    return "text-red-600 bg-red-100";
  };

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Í≤ÄÏÉâ Ìó§Îçî */}
      <div className="bg-white border-b border-gray-200 sticky top-16 z-40">
        <div className="container mx-auto px-4 py-4">
          {/* Í≤ÄÏÉâÎ∞î */}
          <div className="mb-4">
            <Input
              type="text"
              placeholder={t("placeholder")}
              value={searchState.query}
              onChange={(e) => handleSearchChange(e.target.value)}
              leftIcon={
                <svg
                  className="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    strokeWidth={2}
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                  />
                </svg>
              }
              className="w-full text-base"
            />
          </div>

          {/* Îπ†Î•∏ ÌïÑÌÑ∞ */}
          <div className="flex items-center gap-2 mb-4 overflow-x-auto pb-2">
            {quickFilters.map((filter) => (
              <Button
                key={filter.id}
                variant={
                  (filter.id === "openNow" && searchState.filters.openNow) ||
                  (filter.id === "topRated" && searchState.filters.rating >= 4)
                    ? "default"
                    : "outline"
                }
                size="sm"
                onClick={() => applyQuickFilter(filter.id)}
                className="whitespace-nowrap flex-shrink-0"
              >
                <span className="mr-1">{filter.icon}</span>
                {filter.label}
              </Button>
            ))}
          </div>

          {/* Í≤∞Í≥º Ïàò & Ïª®Ìä∏Î°§ */}
          <div className="flex items-center justify-between">
            <div className="text-sm text-gray-600">
              {totalResults > 0 && t("results.found", { count: totalResults })}
            </div>

            <div className="flex items-center gap-2">
              {/* Ï†ïÎ†¨ */}
              <select
                value={searchState.sortBy}
                onChange={(e) => handleSortChange(e.target.value)}
                className="text-sm border border-gray-300 rounded-lg px-3 py-2 bg-white"
              >
                {sortOptions.map((option) => (
                  <option key={option.value} value={option.value}>
                    {option.label}
                  </option>
                ))}
              </select>

              {/* ÌïÑÌÑ∞ Î≤ÑÌäº */}
              <Button
                variant="outline"
                size="sm"
                onClick={() => setIsFilterModalOpen(true)}
                className="flex items-center gap-2"
              >
                <svg
                  className="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    strokeWidth={2}
                    d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                  />
                </svg>
                {t("filters.title")}
              </Button>

              {/* Î∑∞ Î™®Îìú ÌÜ†Í∏Ä */}
              <div className="flex border border-gray-300 rounded-lg overflow-hidden">
                <Button
                  variant={
                    searchState.viewMode === "list" ? "default" : "ghost"
                  }
                  size="sm"
                  onClick={() =>
                    setSearchState((prev) => ({ ...prev, viewMode: "list" }))
                  }
                  className="rounded-none"
                >
                  <svg
                    className="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M4 6h16M4 10h16M4 14h16M4 18h16"
                    />
                  </svg>
                </Button>
                <Button
                  variant={searchState.viewMode === "map" ? "default" : "ghost"}
                  size="sm"
                  onClick={() =>
                    setSearchState((prev) => ({ ...prev, viewMode: "map" }))
                  }
                  className="rounded-none"
                >
                  <svg
                    className="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"
                    />
                  </svg>
                </Button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Î©îÏù∏ Ïª®ÌÖêÏ∏† */}
      <div className="container mx-auto px-4 py-6">
        {searchState.viewMode === "list" ? (
          /* Î¶¨Ïä§Ìä∏ Î∑∞ */
          <div className="space-y-4">
            {isLoading && places.length === 0 ? (
              // Î°úÎî© Ïä§ÏºàÎ†àÌÜ§
              Array.from({ length: 6 }).map((_, index) => (
                <Card key={index} className="overflow-hidden">
                  <div className="flex">
                    <Skeleton variant="rectangular" className="w-48 h-32" />
                    <CardContent className="flex-1 p-4">
                      <Skeleton variant="text" className="h-6 mb-2 w-3/4" />
                      <Skeleton variant="text" className="h-4 mb-2 w-1/2" />
                      <Skeleton variant="text" lines={2} className="mb-3" />
                      <div className="flex gap-2">
                        <Skeleton variant="rectangular" className="h-6 w-16" />
                        <Skeleton variant="rectangular" className="h-6 w-16" />
                      </div>
                    </CardContent>
                  </div>
                </Card>
              ))
            ) : places.length > 0 ? (
              places.map((place, index) => (
                <SearchResultItem
                  key={place.id}
                  place={place}
                  isSaved={savedPlaces.has(place.id)}
                  onToggleSave={toggleSavePlace}
                  onGetDirections={(place) => {
                    // Í∏∏Ï∞æÍ∏∞ Î°úÏßÅ (Ïπ¥Ïπ¥Ïò§Îßµ, ÎÑ§Ïù¥Î≤ÑÏßÄÎèÑ, Íµ¨Í∏ÄÎßµ Îì±)
                    console.log("Í∏∏Ï∞æÍ∏∞:", place);
                  }}
                  viewMode="list"
                />
              ))
            ) : (
              // Í≤ÄÏÉâ Í≤∞Í≥º ÏóÜÏùå
              <SearchEmptyState
                query={searchState.query}
                onClearSearch={() => {
                  setSearchState((prev) => ({ ...prev, query: "" }));
                  setPlaces([]);
                }}
                suggestions={searchSuggestions.getPopularSearches().slice(0, 6)}
                onSuggestionClick={handleSearchChange}
              />
            )}

            {/* Îçî Î≥¥Í∏∞ Î≤ÑÌäº */}
            {places.length > 0 && searchState.hasMore && (
              <div className="text-center py-6">
                <Button
                  variant="outline"
                  onClick={() =>
                    performSearch(
                      searchState.query,
                      searchState.filters,
                      searchState.sortBy,
                      searchState.page + 1
                    )
                  }
                  disabled={isLoading}
                >
                  {isLoading ? "Î°úÎî©Ï§ë..." : t("results.loadMore")}
                </Button>
              </div>
            )}
          </div>
        ) : (
          /* ÏßÄÎèÑ Î∑∞ */
          <div className="bg-white rounded-xl p-8 text-center">
            <div className="w-16 h-16 mx-auto bg-gray-100 rounded-full flex items-center justify-center mb-4">
              <svg
                className="w-8 h-8 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"
                />
              </svg>
            </div>
            <h3 className="text-lg font-semibold text-gray-900 mb-2">
              ÏßÄÎèÑ Î∑∞
            </h3>
            <p className="text-gray-600 mb-4">
              ÏßÄÎèÑ Í∏∞Îä•ÏùÄ Í≥ß Íµ¨ÌòÑÎê† ÏòàÏ†ïÏûÖÎãàÎã§.
            </p>
            <p className="text-sm text-gray-500">
              Ïπ¥Ïπ¥Ïò§Îßµ, ÎÑ§Ïù¥Î≤ÑÏßÄÎèÑ, Íµ¨Í∏ÄÎßµ Ïó∞ÎèôÏùÑ ÌÜµÌïú Î©ÄÌã∞Îßµ Í∏∞Îä•ÏùÑ Ï†úÍ≥µÌï†
              ÏòàÏ†ïÏûÖÎãàÎã§.
            </p>
          </div>
        )}
      </div>

      {/* ÌïÑÌÑ∞ Î™®Îã¨ */}
      <Modal
        isOpen={isFilterModalOpen}
        onClose={() => setIsFilterModalOpen(false)}
        title={t("filters.title")}
        size="lg"
      >
        <div className="space-y-6">
          {/* Ïπ¥ÌÖåÍ≥†Î¶¨ */}
          <div>
            <h4 className="font-semibold mb-3">{t("filters.category")}</h4>
            <div className="grid grid-cols-2 gap-2">
              {categories.map((category) => (
                <Button
                  key={category.id}
                  variant={
                    searchState.filters.category === category.id
                      ? "default"
                      : "outline"
                  }
                  size="sm"
                  onClick={() => handleFilterChange({ category: category.id })}
                  className="justify-start"
                >
                  <span className="mr-2">{category.icon}</span>
                  {category.name}
                </Button>
              ))}
            </div>
          </div>

          {/* ÌèâÏ†ê */}
          <div>
            <h4 className="font-semibold mb-3">{t("filters.rating")}</h4>
            <div className="flex gap-2">
              {[0, 3, 4, 4.5].map((rating) => (
                <Button
                  key={rating}
                  variant={
                    searchState.filters.rating === rating
                      ? "default"
                      : "outline"
                  }
                  size="sm"
                  onClick={() => handleFilterChange({ rating })}
                >
                  {rating === 0 ? "Ï†ÑÏ≤¥" : `${rating}‚≠ê Ïù¥ÏÉÅ`}
                </Button>
              ))}
            </div>
          </div>

          {/* Í±∞Î¶¨ */}
          <div>
            <h4 className="font-semibold mb-3">{t("filters.distance")}</h4>
            <select
              value={searchState.filters.distance}
              onChange={(e) => handleFilterChange({ distance: e.target.value })}
              className="w-full border border-gray-300 rounded-lg px-3 py-2"
            >
              <option value="all">Ï†ÑÏ≤¥</option>
              <option value="500">500m Ïù¥ÎÇ¥</option>
              <option value="1000">1km Ïù¥ÎÇ¥</option>
              <option value="2000">2km Ïù¥ÎÇ¥</option>
              <option value="5000">5km Ïù¥ÎÇ¥</option>
            </select>
          </div>

          {/* Í∞ÄÍ≤©ÎåÄ */}
          <div>
            <h4 className="font-semibold mb-3">{t("filters.price")}</h4>
            <div className="flex gap-2">
              {[
                { value: "all", label: "Ï†ÑÏ≤¥" },
                { value: "1", label: "‚Ç© Ï†ÄÎ†¥" },
                { value: "2", label: "‚Ç©‚Ç© Î≥¥ÌÜµ" },
                { value: "3", label: "‚Ç©‚Ç©‚Ç© ÎπÑÏåà" },
                { value: "4", label: "‚Ç©‚Ç©‚Ç©‚Ç© Í≥†Í∏â" },
              ].map((price) => (
                <Button
                  key={price.value}
                  variant={
                    searchState.filters.priceLevel === price.value
                      ? "default"
                      : "outline"
                  }
                  size="sm"
                  onClick={() =>
                    handleFilterChange({ priceLevel: price.value })
                  }
                >
                  {price.label}
                </Button>
              ))}
            </div>
          </div>

          {/* Í∏∞ÌÉÄ ÏòµÏÖò */}
          <div>
            <h4 className="font-semibold mb-3">Í∏∞ÌÉÄ ÏòµÏÖò</h4>
            <div className="space-y-3">
              <label className="flex items-center">
                <input
                  type="checkbox"
                  checked={searchState.filters.openNow}
                  onChange={(e) =>
                    handleFilterChange({ openNow: e.target.checked })
                  }
                  className="mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                />
                <span className="text-sm">{t("filters.openNow")}</span>
              </label>

              <label className="flex items-center">
                <input
                  type="checkbox"
                  checked={searchState.filters.freeWifi}
                  onChange={(e) =>
                    handleFilterChange({ freeWifi: e.target.checked })
                  }
                  className="mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                />
                <span className="text-sm">{t("filters.freeWifi")}</span>
              </label>

              <label className="flex items-center">
                <input
                  type="checkbox"
                  checked={searchState.filters.parking}
                  onChange={(e) =>
                    handleFilterChange({ parking: e.target.checked })
                  }
                  className="mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                />
                <span className="text-sm">{t("filters.parking")}</span>
              </label>

              <label className="flex items-center">
                <input
                  type="checkbox"
                  checked={searchState.filters.accessibility}
                  onChange={(e) =>
                    handleFilterChange({ accessibility: e.target.checked })
                  }
                  className="mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                />
                <span className="text-sm">{t("filters.accessibility")}</span>
              </label>
            </div>
          </div>

          {/* Î≤ÑÌäºÎì§ */}
          <div className="flex gap-3 pt-4 border-t">
            <Button
              variant="outline"
              onClick={() => {
                setSearchState((prev) => ({
                  ...prev,
                  filters: {
                    category: "all",
                    location: "",
                    rating: 0,
                    priceLevel: "all",
                    distance: "all",
                    openNow: false,
                    freeWifi: false,
                    parking: false,
                    accessibility: false,
                  },
                }));
              }}
              className="flex-1"
            >
              {t("filters.clearFilters")}
            </Button>
            <Button
              onClick={() => {
                performSearch(
                  searchState.query,
                  searchState.filters,
                  searchState.sortBy
                );
                setIsFilterModalOpen(false);
              }}
              className="flex-1"
            >
              {t("filters.applyFilters")}
            </Button>
          </div>
        </div>
      </Modal>
    </div>
  );
}
